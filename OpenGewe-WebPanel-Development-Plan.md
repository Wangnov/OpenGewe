# OpenGewe å¤šå¾®ä¿¡æœºå™¨äººç®¡ç†åå°å¼€å‘è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡
å¼€å‘ä¸€ä¸ªç°ä»£åŒ–çš„ã€ç§»åŠ¨ç«¯å…¼å®¹çš„å¤šå¾®ä¿¡æœºå™¨äººç®¡ç†åå°ï¼Œæ·±åº¦é›†æˆ OpenGewe æ¡†æ¶ï¼Œæä¾›å…¨é¢çš„å¾®ä¿¡æœºå™¨äººç®¡ç†åŠŸèƒ½ã€‚

### é¡¹ç›®ç‰¹ç‚¹
- **å¤šæœºå™¨äººç®¡ç†**ï¼šæ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªå¾®ä¿¡æœºå™¨äººå®ä¾‹
- **ç°ä»£åŒ–ç•Œé¢**ï¼šå“åº”å¼è®¾è®¡ï¼ŒåŒæ—¶æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **æ·±åº¦é›†æˆ**ï¼šå……åˆ†åˆ©ç”¨ OpenGewe çš„å¼‚æ­¥ç‰¹æ€§ã€æ¶ˆæ¯å¤„ç†å’Œæ’ä»¶ç³»ç»Ÿ
- **å®æ—¶é€šä¿¡**ï¼šWebSocket æ”¯æŒå®æ—¶æ¶ˆæ¯å±•ç¤º

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (React + TS)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç®¡ç†å‘˜ç•Œé¢     â”‚ â”‚   æœºå™¨äººç®¡ç†     â”‚ â”‚   èŠå¤©ç•Œé¢      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ (FastAPI)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Webhook æ¥å£    â”‚ â”‚  RESTful API   â”‚ â”‚  WebSocket æœåŠ¡  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GeweClient æ±    â”‚ â”‚  æ’ä»¶ç®¡ç†å™¨      â”‚ â”‚  æ¶ˆæ¯å¤„ç†å™¨      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åº“å±‚ (MySQL)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç®¡ç†å‘˜æ•°æ®     â”‚ â”‚ bot_app_id_abc  â”‚ â”‚  bot_app_id_xyz â”‚ â”‚
â”‚  â”‚     Schema      â”‚ â”‚     Schema      â”‚ â”‚     Schema      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨æœåŠ¡é›†æˆ                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    GeWeAPI      â”‚ â”‚     Redis       â”‚ â”‚   RabbitMQ      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦ç»†è¯´æ˜

### å‰ç«¯æŠ€æœ¯æ ˆ
```typescript
// æ ¸å¿ƒæ¡†æ¶
React 18+ + TypeScript 5+

// UI ç»„ä»¶åº“
Ant Design 5.25 (æ¡Œé¢ç«¯ä¸»è¦)
Ant Design Mobile 5.x (ç§»åŠ¨ç«¯è¡¥å……)

// çŠ¶æ€ç®¡ç†
Zustand 4.x (è½»é‡çº§çŠ¶æ€ç®¡ç†)

// æ•°æ®è¯·æ±‚
React Query/TanStack Query 5.x (æ•°æ®è·å–å’Œç¼“å­˜)

// è·¯ç”±
React Router 6.x

// æ„å»ºå·¥å…·
Vite 5.x + SWC

// ä»£ç è´¨é‡
ESLint + Prettier + Husky
TypeScript strict mode

// æ ·å¼æ–¹æ¡ˆ
CSS Modules + Tailwind CSS

// å®æ—¶é€šä¿¡
Socket.IO Client

// å›¾è¡¨åº“
Apache ECharts (æ¶ˆæ¯ç»Ÿè®¡å›¾è¡¨)
```

### åç«¯æŠ€æœ¯æ ˆ
```python
# æ ¸å¿ƒæ¡†æ¶
FastAPI 0.115+ + Python 3.13+

# å¾®ä¿¡æœºå™¨äººæ¡†æ¶
OpenGewe 0.1.1+ (ä½œä¸ºç¬¬ä¸‰æ–¹åº“)

# æ•°æ®åº“
SQLAlchemy 2.x (å¼‚æ­¥æ¨¡å¼)
Pydantic 2.x (æ•°æ®æ ¡éªŒ)
MySQL 8+

# ä»»åŠ¡é˜Ÿåˆ—
Celery + Redis + RabbitMQ

# è®¤è¯æˆæƒ
python-jose (JWT)
passlib (å¯†ç å“ˆå¸Œ)

# WebSocket
FastAPI WebSocket + Socket.IO

# é…ç½®ç®¡ç†
python-decouple (ç¯å¢ƒå˜é‡)
tomli (TOML é…ç½®æ–‡ä»¶)

# æ—¥å¿—
Loguru (é›†æˆ OpenGewe æ—¥å¿—ç³»ç»Ÿ)

# å…¶ä»–å·¥å…·
aiofiles (å¼‚æ­¥æ–‡ä»¶æ“ä½œ)
aioredis (å¼‚æ­¥ Redis å®¢æˆ·ç«¯)
aiomysql (å¼‚æ­¥ MySQL å®¢æˆ·ç«¯)
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è¯¦è§£

### å…¨å±€ç®¡ç†å‘˜æ•°æ®åº“ (`admin_data`)

#### ç®¡ç†å‘˜è¡¨ (`admins`)
```sql
CREATE TABLE admins (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    is_superadmin BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP NULL,
    
    INDEX idx_username (username),
);
```

#### ç®¡ç†å‘˜ç™»å½•æ—¥å¿—è¡¨ (`admin_login_logs`)
```sql
CREATE TABLE admin_login_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    admin_id INT NOT NULL,
    login_ip VARCHAR(45),
    user_agent TEXT,
    login_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status ENUM('success', 'failed') NOT NULL,
    failure_reason VARCHAR(255),
    
    FOREIGN KEY (admin_id) REFERENCES admins(id) ON DELETE CASCADE,
    INDEX idx_admin_id (admin_id),
    INDEX idx_login_at (login_at)
);
```

#### å…¨å±€æ’ä»¶é…ç½®è¡¨ (`global_plugins`)
```sql
CREATE TABLE global_plugins (
    id INT PRIMARY KEY AUTO_INCREMENT,
    plugin_name VARCHAR(100) UNIQUE NOT NULL,
    is_globally_enabled BOOLEAN DEFAULT TRUE,
    global_config_json JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_plugin_name (plugin_name)
);
```

### æœºå™¨äººå®ä¾‹æ•°æ®åº“ (æ¯ä¸ª Schema: `bot_{app_id}`)

#### æœºå™¨äººä¿¡æ¯è¡¨ (`bot_info`)
```sql
CREATE TABLE bot_info (
    bot_wxid VARCHAR(50) PRIMARY KEY,
    gewe_app_id VARCHAR(100) UNIQUE NOT NULL,
    gewe_token VARCHAR(255) NOT NULL,
    nickname VARCHAR(100),
    avatar_url TEXT,
    qr_code_url TEXT,
    is_online BOOLEAN DEFAULT FALSE,
    last_seen_at TIMESTAMP NULL,
    callback_url_override VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_gewe_app_id (gewe_app_id),
    INDEX idx_is_online (is_online)
);
```

#### åŸå§‹å›è°ƒæ¶ˆæ¯è¡¨ (`raw_callback_log`)
```sql
CREATE TABLE raw_callback_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    received_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    bot_wxid VARCHAR(50),
    gewe_appid VARCHAR(100) NOT NULL,
    type_name VARCHAR(50) NOT NULL,
    msg_id VARCHAR(100),
    new_msg_id VARCHAR(100),
    from_wxid VARCHAR(100),
    to_wxid VARCHAR(100),
    raw_json_data JSON NOT NULL,
    processed BOOLEAN DEFAULT FALSE,
    
    INDEX idx_received_at (received_at),
    INDEX idx_bot_wxid (bot_wxid),
    INDEX idx_gewe_appid_type (gewe_appid, type_name),
    INDEX idx_msg_id (msg_id),
    INDEX idx_new_msg_id (new_msg_id),
    INDEX idx_chat_pair (from_wxid, to_wxid),
    INDEX idx_processed (processed)
);
```

#### è”ç³»äººè¡¨ (`contacts`)
```sql
CREATE TABLE contacts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    bot_wxid VARCHAR(50) NOT NULL,
    contact_wxid VARCHAR(100) NOT NULL,
    contact_type ENUM('friend', 'group', 'public_account', 'enterprise') NOT NULL,
    nickname VARCHAR(200),
    remark VARCHAR(200),
    alias VARCHAR(100),
    big_head_img_url TEXT,
    small_head_img_url TEXT,
    signature TEXT,
    sex TINYINT,
    country VARCHAR(50),
    province VARCHAR(50),
    city VARCHAR(50),
    is_deleted BOOLEAN DEFAULT FALSE,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_bot_contact (bot_wxid, contact_wxid),
    INDEX idx_contact_type (contact_type),
    INDEX idx_nickname (nickname),
    INDEX idx_is_deleted (is_deleted)
);
```

#### ç¾¤æˆå‘˜è¡¨ (`group_members`)
```sql
CREATE TABLE group_members (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    bot_wxid VARCHAR(50) NOT NULL,
    group_wxid VARCHAR(100) NOT NULL,
    member_wxid VARCHAR(100) NOT NULL,
    nickname VARCHAR(200),
    display_name VARCHAR(200),
    is_admin BOOLEAN DEFAULT FALSE,
    is_owner BOOLEAN DEFAULT FALSE,
    join_time TIMESTAMP NULL,
    is_active BOOLEAN DEFAULT TRUE,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_group_member (bot_wxid, group_wxid, member_wxid),
    INDEX idx_group_wxid (group_wxid),
    INDEX idx_member_wxid (member_wxid),
    INDEX idx_is_admin (is_admin),
    INDEX idx_is_active (is_active)
);
```

#### æœºå™¨äººæ’ä»¶é…ç½®è¡¨ (`bot_plugins`)
```sql
CREATE TABLE bot_plugins (
    id INT PRIMARY KEY AUTO_INCREMENT,
    bot_wxid VARCHAR(50) NOT NULL,
    plugin_name VARCHAR(100) NOT NULL,
    is_enabled BOOLEAN DEFAULT TRUE,
    config_json JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_bot_plugin (bot_wxid, plugin_name),
    INDEX idx_plugin_name (plugin_name),
    INDEX idx_is_enabled (is_enabled)
);
```

#### æœ‹å‹åœˆè®°å½•è¡¨ (`sns_posts`)
```sql
CREATE TABLE sns_posts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    bot_wxid VARCHAR(50) NOT NULL,
    sns_id BIGINT NOT NULL,
    author_wxid VARCHAR(100) NOT NULL,
    content TEXT,
    media_urls JSON,
    post_type ENUM('text', 'image', 'video', 'link', 'finder') NOT NULL,
    like_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    create_time TIMESTAMP NOT NULL,
    privacy_settings JSON,
    raw_data JSON,
    
    UNIQUE KEY uk_bot_sns (bot_wxid, sns_id),
    INDEX idx_author_wxid (author_wxid),
    INDEX idx_create_time (create_time),
    INDEX idx_post_type (post_type)
);
```

## ğŸ“± åŠŸèƒ½æ¨¡å—è¯¦ç»†è§„åˆ’

### 1. è®¤è¯ä¸æˆæƒæ¨¡å—

#### 1.1 ç®¡ç†å‘˜ç™»å½•
**å‰ç«¯å®ç°ï¼š**
```typescript
// ç™»å½•è¡¨å•ç»„ä»¶
interface LoginForm {
  username: string;
  password: string;
  remember?: boolean;
}

// è®¤è¯çŠ¶æ€ç®¡ç†
interface AuthState {
  isAuthenticated: boolean;
  user: Admin | null;
  token: string | null;
}
```

**åç«¯æ¥å£ï¼š**
```python
# ç™»å½•æ¥å£
POST /api/auth/login
{
  "username": "admin",
  "password": "password"
}

# å“åº”
{
  "access_token": "jwt_token",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "is_superadmin": true
  }
}
```

#### 1.2 æƒé™æ§åˆ¶
- **è¶…çº§ç®¡ç†å‘˜**ï¼šæ‰€æœ‰æƒé™
- **æ™®é€šç®¡ç†å‘˜**ï¼šåªèƒ½ç®¡ç†æŒ‡å®šçš„æœºå™¨äººå®ä¾‹
- **JWT ä¸­é—´ä»¶**ï¼šéªŒè¯æ‰€æœ‰ API è¯·æ±‚
- **è·¯ç”±å®ˆå«**ï¼šå‰ç«¯è·¯ç”±çº§åˆ«çš„æƒé™æ§åˆ¶

### 2. æœºå™¨äººå®ä¾‹ç®¡ç†æ¨¡å—

#### 2.1 æœºå™¨äººåˆ—è¡¨é¡µé¢
**åŠŸèƒ½ç‰¹æ€§ï¼š**
- å¡ç‰‡å¼å±•ç¤ºæ‰€æœ‰æœºå™¨äººå®ä¾‹
- å®æ—¶æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€ï¼ˆWebSocket æ›´æ–°ï¼‰
- æœç´¢å’Œç­›é€‰åŠŸèƒ½
- æ‰¹é‡æ“ä½œï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

**å‰ç«¯ç»„ä»¶ç»“æ„ï¼š**
```typescript
interface BotInstance {
  botWxid: string;
  geweAppId: string;
  nickname: string;
  avatarUrl: string;
  isOnline: boolean;
  lastSeenAt: string;
  messageCount24h: number;
}

// æœºå™¨äººå¡ç‰‡ç»„ä»¶
const BotCard: React.FC<{ bot: BotInstance }> = ({ bot }) => {
  // å®ç°å¡ç‰‡æ˜¾ç¤ºé€»è¾‘
};
```

#### 2.2 æ·»åŠ æœºå™¨äººæµç¨‹
**æ­¥éª¤è®¾è®¡ï¼š**
1. **è¾“å…¥åŸºæœ¬ä¿¡æ¯**ï¼š`gewe_app_id` å’Œ `gewe_token`
2. **éªŒè¯è¿æ¥**ï¼šæµ‹è¯•ä¸ GeWeAPI çš„è¿æ¥
3. **è·å–æœºå™¨äººä¿¡æ¯**ï¼šè‡ªåŠ¨è·å–æ˜µç§°ã€å¤´åƒç­‰
4. **åˆå§‹åŒ–æ•°æ®åº“**ï¼šåˆ›å»ºä¸“å± Schema
5. **åŒæ­¥è”ç³»äºº**ï¼šåå°å¼‚æ­¥åŒæ­¥è”ç³»äººå’Œç¾¤èŠæ•°æ®

**åç«¯å®ç°é€»è¾‘ï¼š**
```python
@router.post("/bots")
async def create_bot(bot_data: BotCreateRequest):
    # 1. éªŒè¯ GeweClient è¿æ¥
    client = GeweClient(
        base_url="http://www.geweapi.com/gewe/v2/api",
        app_id=bot_data.gewe_app_id,
        token=bot_data.gewe_token,
        is_gewe=True
    )
    
    # 2. æ£€æŸ¥åœ¨çº¿çŠ¶æ€
    online_status = await client.account.check_online()
    if not online_status.get("data"):
        raise HTTPException(400, "æœºå™¨äººç¦»çº¿æˆ–é…ç½®é”™è¯¯")
    
    # 3. è·å–æœºå™¨äººä¿¡æ¯
    profile = await client.personal.get_profile()
    
    # 4. åˆ›å»ºæ•°æ®åº“ Schema
    await create_bot_schema(profile["data"]["wxid"])
    
    # 5. ä¿å­˜æœºå™¨äººä¿¡æ¯
    bot_info = await save_bot_info(profile["data"])
    
    # 6. å¯åŠ¨åå°åŒæ­¥ä»»åŠ¡
    sync_contacts_task.delay(bot_info.bot_wxid)
    
    return bot_info
```

### 3. èŠå¤©ç®¡ç†æ¨¡å—

#### 3.1 èŠå¤©ç•Œé¢è®¾è®¡
**å¸ƒå±€ç»“æ„ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     èŠå¤©ç®¡ç†ç•Œé¢                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                èŠå¤©çª—å£                     â”‚
â”‚   è”ç³»äººåˆ—è¡¨  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚              â”‚  â”‚          æ¶ˆæ¯å†å²è®°å½•                â”‚   â”‚
â”‚  ğŸ” æœç´¢æ¡†    â”‚  â”‚                                      â”‚   â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ğŸ“± å¼ ä¸‰      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  ğŸ¢ å·¥ä½œç¾¤    â”‚  â”‚          æ¶ˆæ¯è¾“å…¥æ¡†                  â”‚   â”‚
â”‚  ğŸ‘¥ æœ‹å‹ç¾¤    â”‚  â”‚  ğŸ“ ğŸ“· ğŸ¤ ğŸ˜Š              å‘é€       â”‚   â”‚
â”‚  ...         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 æ¶ˆæ¯ç±»å‹æ”¯æŒ
**æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼š**
- âœ… æ–‡æœ¬æ¶ˆæ¯ï¼ˆæ”¯æŒ @ åŠŸèƒ½ï¼‰
- âœ… å›¾ç‰‡æ¶ˆæ¯ï¼ˆæ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼‰
- âœ… è¯­éŸ³æ¶ˆæ¯ï¼ˆå½•éŸ³åŠŸèƒ½ï¼‰
- âœ… è§†é¢‘æ¶ˆæ¯
- âœ… æ–‡ä»¶æ¶ˆæ¯
- âœ… è¡¨æƒ…æ¶ˆæ¯
- âœ… é“¾æ¥æ¶ˆæ¯
- âœ… åç‰‡æ¶ˆæ¯
- â­ å¼•ç”¨å›å¤
- â­ æ¶ˆæ¯æ’¤å›

**å‰ç«¯æ¶ˆæ¯ç»„ä»¶ï¼š**
```typescript
interface Message {
  id: string;
  type: MessageType;
  content: string;
  fromWxid: string;
  toWxid: string;
  timestamp: number;
  isFromSelf: boolean;
  status: 'sending' | 'sent' | 'failed';
  media?: {
    url: string;
    thumbnail?: string;
    size?: number;
    duration?: number;
  };
}

const MessageBubble: React.FC<{ message: Message }> = ({ message }) => {
  // æ ¹æ®æ¶ˆæ¯ç±»å‹æ¸²æŸ“ä¸åŒçš„æ°”æ³¡æ ·å¼
};
```

#### 3.3 å®æ—¶æ¶ˆæ¯å¤„ç†
**WebSocket æ¶ˆæ¯æµï¼š**
```typescript
// WebSocket äº‹ä»¶ç±»å‹
interface WebSocketEvents {
  'new_message': Message;
  'message_status_update': { messageId: string; status: string };
  'bot_status_change': { botWxid: string; isOnline: boolean };
  'typing_indicator': { chatId: string; userWxid: string; isTyping: boolean };
}

// WebSocket è¿æ¥ç®¡ç†
class WebSocketManager {
  private socket: Socket;
  
  connect(token: string) {
    this.socket = io('/chat', {
      auth: { token },
      transports: ['websocket']
    });
  }
  
  subscribeToBot(botWxid: string) {
    this.socket.emit('subscribe_bot', { botWxid });
  }
}
```

### 4. æœ‹å‹åœˆç®¡ç†æ¨¡å—

#### 4.1 æœ‹å‹åœˆå‘å¸ƒåŠŸèƒ½
**å‘å¸ƒç±»å‹ï¼š**
- çº¯æ–‡æœ¬æœ‹å‹åœˆ
- å›¾ç‰‡æœ‹å‹åœˆï¼ˆæ”¯æŒå¤šå›¾ï¼‰
- è§†é¢‘æœ‹å‹åœˆ
- é“¾æ¥æœ‹å‹åœˆ

**å‰ç«¯å‘å¸ƒç»„ä»¶ï¼š**
```typescript
interface SnsPostData {
  content: string;
  type: 'text' | 'image' | 'video' | 'link';
  mediaFiles?: File[];
  privacy: {
    allowWxids?: string[];
    disableWxids?: string[];
    allowTagIds?: string[];
    disableTagIds?: string[];
    isPrivate: boolean;
  };
  location?: string;
  atWxids?: string[];
}

const SnsPublisher: React.FC = () => {
  // æœ‹å‹åœˆå‘å¸ƒç»„ä»¶å®ç°
};
```

#### 4.2 æœ‹å‹åœˆæµè§ˆåŠŸèƒ½
- æŸ¥çœ‹è‡ªå·±å‘å¸ƒçš„æœ‹å‹åœˆ
- æµè§ˆå¥½å‹æœ‹å‹åœˆ
- ç‚¹èµå’Œè¯„è®ºåŠŸèƒ½
- æœ‹å‹åœˆæ•°æ®åŒæ­¥

### 5. æ’ä»¶ç®¡ç†æ¨¡å—

#### 5.1 å…¨å±€æ’ä»¶ç®¡ç†
**åŠŸèƒ½åˆ—è¡¨ï¼š**
- æ’ä»¶åˆ—è¡¨å±•ç¤ºï¼ˆä» `plugins` ç›®å½•æ‰«æï¼‰
- å…¨å±€å¯ç”¨/ç¦ç”¨æ’ä»¶
- æ’ä»¶é…ç½®ç®¡ç†
- æ’ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

**æ’ä»¶ä¿¡æ¯ç»“æ„ï¼š**
```typescript
interface PluginInfo {
  name: string;
  description: string;
  author: string;
  version: string;
  isGloballyEnabled: boolean;
  configSchema?: JSONSchema;
  globalConfig?: Record<string, any>;
  enabledBots: string[];
  totalBots: number;
}
```

#### 5.2 æœºå™¨äººçº§åˆ«æ’ä»¶é…ç½®
- ç»§æ‰¿å…¨å±€é…ç½®
- è¦†ç›–ç‰¹å®šæœºå™¨äººé…ç½®
- æ’ä»¶é…ç½®éªŒè¯
- é…ç½®å˜æ›´å®æ—¶ç”Ÿæ•ˆ

### 6. ç»Ÿè®¡ä¸ç›‘æ§æ¨¡å—

#### 6.1 æ•°æ®ç»Ÿè®¡åŠŸèƒ½
**ç»Ÿè®¡ç»´åº¦ï¼š**
- æ¶ˆæ¯é‡ç»Ÿè®¡ï¼ˆ24å°æ—¶ã€7å¤©ã€30å¤©ï¼‰
- æ´»è·ƒè”ç³»äººç»Ÿè®¡
- æ’ä»¶ä½¿ç”¨ç»Ÿè®¡
- é”™è¯¯æ—¥å¿—ç»Ÿè®¡

**å›¾è¡¨å±•ç¤ºï¼š**
```typescript
interface StatisticsData {
  messageStats: {
    total: number;
    byType: Record<string, number>;
    trend: Array<{ date: string; count: number }>;
  };
  contactStats: {
    totalFriends: number;
    totalGroups: number;
    activeContacts: number;
  };
  pluginStats: {
    enabledCount: number;
    totalCount: number;
    usage: Array<{ plugin: string; calls: number }>;
  };
}
```

#### 6.2 ç³»ç»Ÿç›‘æ§
- æœºå™¨äººåœ¨çº¿çŠ¶æ€ç›‘æ§
- æ¶ˆæ¯å¤„ç†å»¶è¿Ÿç›‘æ§
- é”™è¯¯ç‡ç›‘æ§
- ç³»ç»Ÿèµ„æºä½¿ç”¨ç›‘æ§

## ğŸš€ å¼€å‘é˜¶æ®µè§„åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„ï¼ˆ4-6å‘¨ï¼‰

#### Week 1-2: é¡¹ç›®åˆå§‹åŒ–ä¸åç«¯åŸºç¡€
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] åˆ›å»ºé¡¹ç›®ä»“åº“å’Œç›®å½•ç»“æ„
- [ ] é…ç½®å¼€å‘ç¯å¢ƒï¼ˆDocker Composeï¼‰
- [ ] æ­å»º FastAPI åŸºç¡€æ¡†æ¶
- [ ] å®ç°æ•°æ®åº“è¿æ¥å’Œæ¨¡å‹å®šä¹‰
- [ ] å®Œæˆ JWT è®¤è¯ç³»ç»Ÿ
- [ ] å®ç°åŸºç¡€çš„ CRUD æ“ä½œ

**æŠ€æœ¯è¦ç‚¹ï¼š**
```python
# é¡¹ç›®ç»“æ„
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ bots.py
â”‚   â”‚   â”œâ”€â”€ webhooks.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ services/
â””â”€â”€ requirements.txt
```

#### Week 3-4: å‰ç«¯åŸºç¡€ä¸è·¯ç”±
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] åˆ›å»º React + TypeScript é¡¹ç›®
- [ ] é…ç½® Vite æ„å»ºå·¥å…·
- [ ] æ­å»ºåŸºç¡€è·¯ç”±ç»“æ„
- [ ] å®ç°ç™»å½•é¡µé¢å’Œè®¤è¯æµç¨‹
- [ ] åˆ›å»ºä¸»è¦é¡µé¢æ¡†æ¶
- [ ] é…ç½®çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰

**å‰ç«¯ç»“æ„ï¼š**
```typescript
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ auth/
â”‚   â””â”€â”€ layout/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”œâ”€â”€ BotManagement.tsx
â”‚   â””â”€â”€ ChatInterface.tsx
â”œâ”€â”€ hooks/
â”œâ”€â”€ stores/
â”œâ”€â”€ utils/
â””â”€â”€ types/
```

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆ6-8å‘¨ï¼‰

#### Week 5-6: æœºå™¨äººç®¡ç†åŠŸèƒ½
**åç«¯ä»»åŠ¡ï¼š**
- [ ] å®ç° GeweClient å®ä¾‹æ± ç®¡ç†
- [ ] å®Œæˆæœºå™¨äºº CRUD æ¥å£
- [ ] å®ç°åŠ¨æ€æ•°æ®åº“ Schema åˆ›å»º
- [ ] é›†æˆ OpenGewe å®¢æˆ·ç«¯

**å‰ç«¯ä»»åŠ¡ï¼š**
- [ ] å®ç°æœºå™¨äººåˆ—è¡¨é¡µé¢
- [ ] åˆ›å»ºæ·»åŠ æœºå™¨äººæµç¨‹
- [ ] å®ç°æœºå™¨äººçŠ¶æ€ç›‘æ§
- [ ] æ·»åŠ æœºå™¨äººæ“ä½œåŠŸèƒ½

#### Week 7-8: Webhook ä¸æ¶ˆæ¯å¤„ç†
**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- [ ] å®ç° Webhook æ¥æ”¶æ¥å£
- [ ] å®Œæˆæ¶ˆæ¯å­˜å‚¨é€»è¾‘
- [ ] å®ç°æ¶ˆæ¯åˆ†å‘æœºåˆ¶
- [ ] é›†æˆ OpenGewe MessageFactory

**æŠ€æœ¯å®ç°ï¼š**
```python
@app.post("/webhook/{bot_schema_id}")
async def webhook_handler(
    bot_schema_id: str,
    payload: Dict[str, Any],
    request: Request
):
    # 1. éªŒè¯æ¥æº
    await verify_webhook_source(request)
    
    # 2. å­˜å‚¨åŸå§‹æ¶ˆæ¯
    await store_raw_callback(bot_schema_id, payload)
    
    # 3. åˆ†å‘ç»™ MessageFactory
    client = get_bot_client(bot_schema_id)
    await client.message_factory.process(payload)
    
    return {"status": "ok"}
```

#### Week 9-10: èŠå¤©ç•Œé¢åŸºç¡€
**åŠŸèƒ½å®ç°ï¼š**
- [ ] è”ç³»äººåˆ—è¡¨ç»„ä»¶
- [ ] èŠå¤©çª—å£å¸ƒå±€
- [ ] æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
- [ ] åŸºç¡€æ¶ˆæ¯å‘é€åŠŸèƒ½

#### Week 11-12: å®æ—¶é€šä¿¡
**WebSocket å®ç°ï¼š**
- [ ] æ­å»º WebSocket æœåŠ¡
- [ ] å®ç°æ¶ˆæ¯å®æ—¶æ¨é€
- [ ] æ·»åŠ åœ¨çº¿çŠ¶æ€åŒæ­¥
- [ ] å®ç°æ¶ˆæ¯çŠ¶æ€æ›´æ–°

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ï¼ˆ4-6å‘¨ï¼‰

#### Week 13-14: æœ‹å‹åœˆç®¡ç†
- [ ] æœ‹å‹åœˆå‘å¸ƒåŠŸèƒ½
- [ ] æœ‹å‹åœˆæµè§ˆç•Œé¢
- [ ] åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤„ç†
- [ ] æœ‹å‹åœˆæ•°æ®åŒæ­¥

#### Week 15-16: æ’ä»¶ç®¡ç†ç³»ç»Ÿ
- [ ] æ’ä»¶æ‰«æå’ŒåŠ è½½
- [ ] æ’ä»¶é…ç½®ç•Œé¢
- [ ] å…¨å±€å’Œå®ä¾‹çº§é…ç½®
- [ ] æ’ä»¶çŠ¶æ€ç®¡ç†

#### Week 17-18: ç»Ÿè®¡ä¸ç›‘æ§
- [ ] æ•°æ®ç»Ÿè®¡æ”¶é›†
- [ ] å›¾è¡¨å±•ç¤ºç»„ä»¶
- [ ] ç³»ç»Ÿç›‘æ§é¢æ¿
- [ ] æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½

### ç¬¬å››é˜¶æ®µï¼šä¼˜åŒ–ä¸éƒ¨ç½²ï¼ˆ2-4å‘¨ï¼‰

#### Week 19-20: æ€§èƒ½ä¼˜åŒ–
- [ ] å‰ç«¯ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- [ ] åç«¯æŸ¥è¯¢ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥å®ç°
- [ ] å†…å­˜å’Œæ€§èƒ½ç›‘æ§

#### Week 21-22: æµ‹è¯•ä¸éƒ¨ç½²
- [ ] å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] éƒ¨ç½²è„šæœ¬ç¼–å†™
- [ ] Docker é•œåƒæ„å»º
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®

## ğŸ”§ å…³é”®æŠ€æœ¯å®ç°è¦ç‚¹

### 1. GeweClient å®ä¾‹æ± ç®¡ç†

```python
class BotClientManager:
    def __init__(self):
        self._clients: Dict[str, GeweClient] = {}
        self._client_configs: Dict[str, Dict] = {}
    
    async def get_client(self, bot_wxid: str) -> GeweClient:
        """è·å–æˆ–åˆ›å»º GeweClient å®ä¾‹"""
        if bot_wxid not in self._clients:
            config = await self._load_bot_config(bot_wxid)
            client = GeweClient(**config)
            self._clients[bot_wxid] = client
            await self._initialize_client(client)
        
        return self._clients[bot_wxid]
    
    async def remove_client(self, bot_wxid: str):
        """å®‰å…¨ç§»é™¤å®¢æˆ·ç«¯å®ä¾‹"""
        if bot_wxid in self._clients:
            await self._clients[bot_wxid].close()
            del self._clients[bot_wxid]
    
    async def reload_client(self, bot_wxid: str):
        """é‡æ–°åŠ è½½å®¢æˆ·ç«¯é…ç½®"""
        await self.remove_client(bot_wxid)
        return await self.get_client(bot_wxid)
```

### 2. åŠ¨æ€æ•°æ®åº“ Schema ç®¡ç†

```python
class DatabaseManager:
    async def create_bot_schema(self, bot_wxid: str):
        """ä¸ºæ–°æœºå™¨äººåˆ›å»ºç‹¬ç«‹çš„æ•°æ®åº“ Schema"""
        schema_name = f"bot_{bot_wxid.replace('@', '_')}"
        
        # åˆ›å»º Schema
        await self.execute(f"CREATE SCHEMA IF NOT EXISTS {schema_name}")
        
        # åˆ›å»ºè¡¨ç»“æ„
        await self._create_bot_tables(schema_name)
        
        return schema_name
    
    async def get_bot_engine(self, bot_wxid: str):
        """è·å–ç‰¹å®šæœºå™¨äººçš„æ•°æ®åº“è¿æ¥"""
        schema_name = f"bot_{bot_wxid.replace('@', '_')}"
        return create_async_engine(
            f"mysql+aiomysql://user:pass@host:port/{schema_name}"
        )
```

### 3. æ¶ˆæ¯å¤„ç†ç®¡é“

```python
class MessageProcessor:
    def __init__(self, bot_manager: BotClientManager):
        self.bot_manager = bot_manager
    
    async def process_webhook(self, bot_schema_id: str, payload: Dict):
        """å¤„ç† Webhook æ¶ˆæ¯"""
        # 1. æ•°æ®éªŒè¯å’Œæ¸…æ´—
        validated_payload = await self._validate_payload(payload)
        
        # 2. å­˜å‚¨åŸå§‹æ¶ˆæ¯
        message_id = await self._store_raw_message(
            bot_schema_id, validated_payload
        )
        
        # 3. æ¶ˆæ¯å»é‡æ£€æŸ¥
        if await self._is_duplicate_message(message_id):
            return
        
        # 4. åˆ†å‘ç»™ OpenGewe
        client = await self.bot_manager.get_client(bot_schema_id)
        await client.message_factory.process(validated_payload)
        
        # 5. å®æ—¶æ¨é€ç»™å‰ç«¯
        await self._broadcast_message(bot_schema_id, validated_payload)
```

### 4. WebSocket æ¶ˆæ¯åˆ†å‘

```python
class WebSocketManager:
    def __init__(self):
        self.active_connections: Dict[str, List[WebSocket]] = {}
    
    async def connect(self, websocket: WebSocket, user_id: str):
        """å»ºç«‹ WebSocket è¿æ¥"""
        await websocket.accept()
        if user_id not in self.active_connections:
            self.active_connections[user_id] = []
        self.active_connections[user_id].append(websocket)
    
    async def broadcast_to_bot_subscribers(
        self, bot_wxid: str, message: Dict
    ):
        """å‘è®¢é˜…ç‰¹å®šæœºå™¨äººçš„ç”¨æˆ·å¹¿æ’­æ¶ˆæ¯"""
        for user_id, connections in self.active_connections.items():
            if await self._user_has_bot_access(user_id, bot_wxid):
                for connection in connections:
                    await connection.send_json(message)
```

### 5. å®‰å…¨æœºåˆ¶å®ç°

```python
# JWT è®¤è¯ä¸­é—´ä»¶
async def verify_token(request: Request):
    """éªŒè¯ JWT Token"""
    token = request.headers.get("Authorization")
    if not token or not token.startswith("Bearer "):
        raise HTTPException(401, "æœªæä¾›æœ‰æ•ˆçš„è®¤è¯ä»¤ç‰Œ")
    
    try:
        payload = jwt.decode(
            token.replace("Bearer ", ""),
            SECRET_KEY,
            algorithms=[ALGORITHM]
        )
        user_id = payload.get("sub")
        if not user_id:
            raise HTTPException(401, "æ— æ•ˆçš„ä»¤ç‰Œ")
        
        return user_id
    except JWTError:
        raise HTTPException(401, "ä»¤ç‰ŒéªŒè¯å¤±è´¥")

# Webhook æ¥æºéªŒè¯
async def verify_webhook_source(request: Request):
    """éªŒè¯ Webhook æ¥æº"""
    # 1. IP ç™½åå•æ£€æŸ¥
    client_ip = request.client.host
    if not await is_whitelisted_ip(client_ip):
        raise HTTPException(403, "IP åœ°å€æœªæˆæƒ")
    
    # 2. ç­¾åéªŒè¯ï¼ˆå¦‚æœ GeWeAPI æä¾›ï¼‰
    signature = request.headers.get("X-Gewe-Signature")
    if signature:
        body = await request.body()
        expected_signature = generate_signature(body)
        if not hmac.compare_digest(signature, expected_signature):
            raise HTTPException(403, "ç­¾åéªŒè¯å¤±è´¥")
```

## ğŸ“¦ éƒ¨ç½²ä¸è¿ç»´ç­–ç•¥

### 1. Docker å®¹å™¨åŒ–éƒ¨ç½²

```dockerfile
# åç«¯ Dockerfile
FROM python:3.13-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

```dockerfile
# å‰ç«¯ Dockerfile
FROM node:20-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
```

### 2. Docker Compose é…ç½®

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=mysql+aiomysql://user:pass@mysql:3306/opengewe
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - mysql
      - redis
    volumes:
      - ./logs:/app/logs
      - ./plugins:/app/plugins

  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend

  mysql:
    image: mysql:9.3
    environment:
      - MYSQL_ROOT_PASSWORD=rootpass
      - MYSQL_DATABASE=opengewe
      - MYSQL_USER=user
      - MYSQL_PASSWORD=pass
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/init:/docker-entrypoint-initdb.d

  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data

  rabbitmq:
    image: rabbitmq:3-management
    environment:
      - RABBITMQ_DEFAULT_USER=user
      - RABBITMQ_DEFAULT_PASS=pass
    ports:
      - "15672:15672"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq

volumes:
  mysql_data:
  redis_data:
  rabbitmq_data:
```

### 3. ç›‘æ§ä¸æ—¥å¿—

```python
# é›†æˆ OpenGewe æ—¥å¿—ç³»ç»Ÿ
from opengewe.logger import get_logger, init_default_logger

# åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
init_default_logger(
    level="INFO",
    structured=True,
    config_file="main_config.toml"
)

# è·å–ä¸“ç”¨æ—¥å¿—è®°å½•å™¨
logger = get_logger("WebPanel.Backend")

# æ·»åŠ è‡ªå®šä¹‰æ—¥å¿—å¤„ç†å™¨
logger.add(
    "logs/webpanel_{time:YYYY-MM-DD}.log",
    rotation="1 day",
    retention="30 days",
    level="INFO"
)
```

### 4. é…ç½®ç®¡ç†

```toml
# main_config.toml
[webpanel]
secret_key = "your-secret-key"
debug = false
cors_origins = ["http://localhost:3000"]

[webpanel.database]
url = "mysql+aiomysql://user:pass@localhost:3306/opengewe"
pool_size = 10
max_overflow = 20

[webpanel.redis]
url = "redis://localhost:6379/0"
max_connections = 10

[webpanel.security]
jwt_expiration_hours = 24
password_min_length = 8
max_login_attempts = 5

[logging]
level = "INFO"
format = "json"
path = "./logs"
stdout = true
```

## ğŸ” æµ‹è¯•ç­–ç•¥

### 1. åç«¯æµ‹è¯•

```python
# å•å…ƒæµ‹è¯•ç¤ºä¾‹
import pytest
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_create_bot():
    response = client.post(
        "/api/bots",
        json={
            "gewe_app_id": "test_app_id",
            "gewe_token": "test_token"
        },
        headers={"Authorization": "Bearer test_token"}
    )
    assert response.status_code == 200
    assert "bot_wxid" in response.json()

# é›†æˆæµ‹è¯•
@pytest.mark.asyncio
async def test_webhook_processing():
    # æ¨¡æ‹Ÿ GeWeAPI å›è°ƒ
    webhook_payload = {
        "Appid": "test_app_id",
        "TypeName": "AddMsg",
        "Data": {
            "MsgType": 1,
            "Content": {"string": "æµ‹è¯•æ¶ˆæ¯"},
            # ... å…¶ä»–å­—æ®µ
        }
    }
    
    response = await client.post(
        "/webhook/test_bot_schema",
        json=webhook_payload
    )
    
    assert response.status_code == 200
    # éªŒè¯æ¶ˆæ¯æ˜¯å¦æ­£ç¡®å­˜å‚¨
    # éªŒè¯æ˜¯å¦æ­£ç¡®åˆ†å‘ç»™ MessageFactory
```

### 2. å‰ç«¯æµ‹è¯•

```typescript
// ç»„ä»¶æµ‹è¯•
import { render, screen, fireEvent } from '@testing-library/react';
import { BotCard } from '@/components/BotCard';

test('displays bot information correctly', () => {
  const bot = {
    botWxid: 'test_wxid',
    nickname: 'æµ‹è¯•æœºå™¨äºº',
    isOnline: true,
    lastSeenAt: '2024-01-01T00:00:00Z'
  };

  render(<BotCard bot={bot} />);
  
  expect(screen.getByText('æµ‹è¯•æœºå™¨äºº')).toBeInTheDocument();
  expect(screen.getByText('åœ¨çº¿')).toBeInTheDocument();
});

// API æµ‹è¯•
import { rest } from 'msw';
import { setupServer } from 'msw/node';

const server = setupServer(
  rest.get('/api/bots', (req, res, ctx) => {
    return res(ctx.json({ bots: [] }));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ç­–ç•¥**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ åˆé€‚çš„ç´¢å¼•
- **åˆ†é¡µæŸ¥è¯¢**ï¼šå¤§æ•°æ®é‡åˆ—è¡¨ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ
- **è¿æ¥æ± **ï¼šä½¿ç”¨æ•°æ®åº“è¿æ¥æ± é¿å…é¢‘ç¹è¿æ¥
- **è¯»å†™åˆ†ç¦»**ï¼šè€ƒè™‘è¯»å†™åˆ†ç¦»æé«˜æŸ¥è¯¢æ€§èƒ½

### 2. ç¼“å­˜ç­–ç•¥
```python
# Redis ç¼“å­˜å®ç°
from aioredis import Redis

class CacheService:
    def __init__(self, redis: Redis):
        self.redis = redis
    
    async def get_bot_info(self, bot_wxid: str):
        """è·å–æœºå™¨äººä¿¡æ¯ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        cache_key = f"bot_info:{bot_wxid}"
        cached = await self.redis.get(cache_key)
        
        if cached:
            return json.loads(cached)
        
        # ä»æ•°æ®åº“è·å–
        bot_info = await fetch_bot_info_from_db(bot_wxid)
        
        # ç¼“å­˜ 1 å°æ—¶
        await self.redis.setex(
            cache_key, 3600, json.dumps(bot_info)
        )
        
        return bot_info
```

### 3. å‰ç«¯ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**ï¼šæŒ‰è·¯ç”±è¿›è¡Œä»£ç åˆ†å‰²
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šé•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- **å›¾ç‰‡æ‡’åŠ è½½**ï¼šèŠå¤©è®°å½•ä¸­çš„å›¾ç‰‡æ‡’åŠ è½½
- **é˜²æŠ–èŠ‚æµ**ï¼šæœç´¢å’Œè¾“å…¥æ¡†ä½¿ç”¨é˜²æŠ–

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. æ•°æ®å®‰å…¨
- **æ•°æ®åŠ å¯†**ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **è¾“å…¥éªŒè¯**ï¼šä¸¥æ ¼çš„è¾“å…¥æ•°æ®éªŒè¯
- **SQL æ³¨å…¥é˜²æŠ¤**ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- **XSS é˜²æŠ¤**ï¼šå‰ç«¯è¾“å‡ºè½¬ä¹‰

### 2. æ¥å£å®‰å…¨
- **è®¤è¯æˆæƒ**ï¼šJWT + RBAC æƒé™æ§åˆ¶
- **HTTPS**ï¼šå¼ºåˆ¶ä½¿ç”¨ HTTPS
- **CORS é…ç½®**ï¼šä¸¥æ ¼çš„è·¨åŸŸé…ç½®
- **API é™æµ**ï¼šé˜²æ­¢æ¥å£æ»¥ç”¨

### 3. Webhook å®‰å…¨
- **IP ç™½åå•**ï¼šé™åˆ¶ Webhook æ¥æº IP
- **ç­¾åéªŒè¯**ï¼šéªŒè¯è¯·æ±‚ç­¾å
- **é‡æ”¾æ”»å‡»é˜²æŠ¤**ï¼šä½¿ç”¨æ—¶é—´æˆ³å’Œéšæœºæ•°
- **æ•°æ®æ ¡éªŒ**ï¼šä¸¥æ ¼æ ¡éªŒ Webhook æ•°æ®æ ¼å¼

## ğŸ“– æ–‡æ¡£ä¸ç»´æŠ¤

### 1. å¼€å‘æ–‡æ¡£
- **API æ–‡æ¡£**ï¼šä½¿ç”¨ FastAPI è‡ªåŠ¨ç”Ÿæˆ
- **ç»„ä»¶æ–‡æ¡£**ï¼šä½¿ç”¨ Storybook ç®¡ç†ç»„ä»¶
- **éƒ¨ç½²æ–‡æ¡£**ï¼šè¯¦ç»†çš„éƒ¨ç½²å’Œé…ç½®è¯´æ˜
- **æ•…éšœæ’é™¤**ï¼šå¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 2. ä»£ç è§„èŒƒ
- **Python**ï¼šéµå¾ª PEP 8 + Black æ ¼å¼åŒ–
- **TypeScript**ï¼šä½¿ç”¨ ESLint + Prettier
- **Git è§„èŒƒ**ï¼šConventional Commits
- **ä»£ç å®¡æŸ¥**ï¼šPull Request å¿…é¡»å®¡æŸ¥

### 3. ç›‘æ§ç»´æŠ¤
- **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§å…³é”®æŒ‡æ ‡
- **æ—¥å¿—åˆ†æ**ï¼šå®šæœŸåˆ†ææ—¥å¿—å‘ç°é—®é¢˜
- **å¤‡ä»½ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“

---

## æ€»ç»“

è¿™ä»½å¼€å‘è®¡åˆ’æ¶µç›–äº† OpenGewe å¤šå¾®ä¿¡æœºå™¨äººç®¡ç†åå°çš„å®Œæ•´å¼€å‘æµç¨‹ï¼Œä»æŠ€æœ¯é€‰å‹åˆ°å…·ä½“å®ç°ï¼Œä»æ•°æ®åº“è®¾è®¡åˆ°éƒ¨ç½²è¿ç»´ã€‚é€šè¿‡åˆ†é˜¶æ®µçš„å¼€å‘æ–¹å¼ï¼Œç¡®ä¿é¡¹ç›®èƒ½å¤Ÿç¨³æ­¥æ¨è¿›ï¼ŒåŒæ—¶ä¿è¯ä»£ç è´¨é‡å’Œç³»ç»Ÿå®‰å…¨æ€§ã€‚

é¡¹ç›®çš„æ ¸å¿ƒä»·å€¼åœ¨äºæ·±åº¦é›†æˆ OpenGewe æ¡†æ¶ï¼Œæä¾›ç°ä»£åŒ–çš„ Web ç•Œé¢æ¥ç®¡ç†å¤šä¸ªå¾®ä¿¡æœºå™¨äººå®ä¾‹ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°è¿›è¡ŒèŠå¤©ã€æœ‹å‹åœˆç®¡ç†ã€æ’ä»¶é…ç½®ç­‰æ“ä½œã€‚

**é¡¹ç›®ä¼°è®¡æ€»å¼€å‘æ—¶é—´ï¼š20-22å‘¨**
**å»ºè®®å›¢é˜Ÿè§„æ¨¡ï¼š2-3åå…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ**
**æŠ€æœ¯éš¾ç‚¹ï¼šGeweClient å®ä¾‹ç®¡ç†ã€å®æ—¶æ¶ˆæ¯å¤„ç†ã€å¤šç§Ÿæˆ·æ•°æ®åº“è®¾è®¡** 