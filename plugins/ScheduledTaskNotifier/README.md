# 动态定时任务提醒 (ScheduledTaskNotifier)

## 概述

本插件提供了一个强大的动态任务管理功能，允许用户通过聊天指令实时创建、查看和删除定时任务。它使用 `APScheduler` 作为核心调度器，并通过本地JSON文件实现任务的持久化，确保机器重启后任务不丢失。

这使得机器人可以作为一个智能的任务助手，用于会议通知、周期性汇报提醒、个人备忘等多种场景。

## 功能

- **动态指令**：通过聊天指令（默认为“提醒”）管理所有任务，无需修改配置文件。
- **两种任务类型**：
  - **定时任务**：在指定的未来某个时间点执行一次。
  - **轮询任务**：每隔指定的秒数重复执行。
- **任务持久化**：所有任务都保存在插件目录下的 `tasks.json` 文件中，重启不丢失。
- **健壮的调度**：基于 `APScheduler`，提供稳定可靠的任务调度。
- **交互式管理**：支持查看当前所有任务列表和删除指定任务。

## 使用方法

1.  确保插件已启用。
2.  在任意聊天窗口中，通过发送指令来管理任务。

### 指令格式

所有指令都以配置文件中设置的 `command_prefix` 开头（默认为“提醒”）。

**1. 添加定时任务**

-   **指令**：`提醒 定时 "YYYY-MM-DD HH:MM:SS" "提醒内容"`
-   **说明**：在指定的日期和时间发送一条提醒。时间必须用双引号包裹。
-   **示例**：`提醒 定时 "2025-12-31 23:59:59" "新年快乐！"`

**2. 添加轮询任务**

-   **指令**：`提醒 轮询 [秒数] "提醒内容"`
-   **说明**：每隔指定的秒数发送一条提醒。内容必须用双引号包裹。
-   **示例**：`提醒 轮询 3600 "已经一个小时了，起来活动一下吧！"`

**3. 查看所有任务**

-   **指令**：`提醒 查看`
-   **说明**：列出当前所有已安排的定时和轮询任务，包括它们的任务ID。

**4. 删除任务**

-   **指令**：`提醒 删除 [任务ID]`
-   **说明**：根据任务ID删除一个已存在的任务。任务ID可以通过“查看”指令获取。
-   **示例**：`提醒 删除 a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6`

**5. 获取帮助**

-   **指令**：`提醒`
-   **说明**：获取帮助信息和指令列表。

## 配置

配置文件 `config.toml` 现在只包含一个选项：

```toml
# ScheduledTaskNotifier 插件的配置文件

# 用于触发任务管理指令的前缀
# 例如，设置为 "任务"，则可以通过 "任务 定时 ..." 来创建任务
command_prefix = "提醒"
```

## 技术实现

- **调度核心**: `apscheduler`
- **任务存储**: `plugins/ScheduledTaskNotifier/tasks.json`
- **指令解析**: `shlex`